# Sesion 21 de Diciembre 2025

## Resumen de la Sesion

En esta sesion se implemento el modulo completo de **Pedidos (CustomerOrder)** que complementa el flujo de ventas iniciado con Presupuestos.

## Contexto Previo

- Los **Presupuestos (Quotes)** ya estaban implementados completamente
- El schema de Prisma ya tenia definidos los modelos `CustomerOrder`, `CustomerOrderItem` y `StockReservation`
- Faltaba implementar la logica de negocio y las interfaces de usuario

## Funcionalidades Implementadas

### 1. Backend - Servicio de Pedidos

**Archivo:** `backend/src/services/orderService.ts`

Funcionalidades:
- `createOrder()` - Crear pedido (directo o desde presupuesto)
- `listOrders()` - Listar pedidos con filtros y paginacion
- `getOrderById()` - Obtener detalle del pedido
- `confirmOrder()` - Confirmar pedido (DRAFT -> CONFIRMED)
- `updateOrderStatus()` - Cambiar estado (CONFIRMED -> PROCESSING -> READY)
- `cancelOrder()` - Cancelar pedido y liberar stock reservado/descontado
- `getDataForSaleConversion()` - Obtener datos para facturacion
- `recordSaleConversion()` - Registrar facturacion de items
- Logica de reserva de stock (`StockBehavior: RESERVE`)
- Logica de descuento inmediato de stock (`StockBehavior: DEDUCT`)

### 2. Backend - Rutas API

**Archivo:** `backend/src/routes/orders.ts`

Endpoints:
- `POST /api/:tenantSlug/orders` - Crear pedido
- `GET /api/:tenantSlug/orders` - Listar pedidos
- `GET /api/:tenantSlug/orders/:id` - Ver pedido
- `GET /api/:tenantSlug/orders/:id/conversion-data` - Datos para facturar
- `PATCH /api/:tenantSlug/orders/:id/status` - Cambiar estado
- `POST /api/:tenantSlug/orders/:id/confirm` - Confirmar
- `POST /api/:tenantSlug/orders/:id/cancel` - Cancelar
- `POST /api/:tenantSlug/orders/:id/record-conversion` - Registrar facturacion

### 3. Backend - Endpoint adicional en Quotes

**Archivo:** `backend/src/routes/quotes.ts` (modificado)

Nuevo endpoint:
- `GET /api/:tenantSlug/quotes/:id/order-conversion-data` - Datos para convertir presupuesto a pedido

**Archivo:** `backend/src/services/quoteService.ts` (modificado)

Nuevo metodo:
- `getDataForOrderConversion()` - Obtener datos pendientes para conversion a pedido

### 4. Frontend - API Client

**Archivo:** `frontend/src/api/orders.ts`

Tipos:
- `StockBehavior`: 'NONE' | 'RESERVE' | 'DEDUCT'
- `OrderStatus`: 'DRAFT' | 'CONFIRMED' | 'PROCESSING' | 'READY' | 'PARTIALLY_INVOICED' | 'COMPLETED' | 'CANCELLED'
- `OrderItem`, `CreateOrderData`, `OrderFilters`

Funciones:
- `ordersApi.createOrder()`
- `ordersApi.getOrders()`
- `ordersApi.getOrderById()`
- `ordersApi.getConversionData()`
- `ordersApi.updateOrderStatus()`
- `ordersApi.confirmOrder()`
- `ordersApi.cancelOrder()`
- `ordersApi.recordSaleConversion()`
- `quotesOrderApi.getOrderConversionData()`

### 5. Frontend - Paginas

**Archivo:** `frontend/src/pages/orders/OrdersPage.tsx`

Listado de pedidos con:
- Filtros por estado, busqueda
- Badges de estado (DRAFT, CONFIRMED, PROCESSING, READY, etc.)
- Badges de comportamiento de stock (Sin Stock, Reservado, Descontado)
- Columnas: Numero, Fecha, Cliente, Entrega, Stock, Total, Estado
- Acciones: Ver detalle, Confirmar, Avanzar estado, Facturar, Cancelar
- Paginacion

**Archivo:** `frontend/src/pages/orders/NewOrderPage.tsx`

Formulario de creacion con:
- Tabs: Datos del Pedido / Productos
- Seleccion de cliente
- Fecha esperada de entrega
- **Comportamiento de stock**: Sin afectar | Reservar | Descontar
- Seleccion de almacen (requerido si se afecta stock)
- Busqueda y seleccion de productos
- Edicion de cantidades, precios, descuentos
- Conversion desde presupuesto (`?fromQuote=id`)
- Calculo automatico de totales

**Archivo:** `frontend/src/pages/orders/OrderDetailPage.tsx`

Vista de detalle con:
- Informacion del pedido
- Estado actual con badge
- Tabla de productos con cantidades facturadas/pendientes
- Reservas de stock (si aplica)
- Informacion del cliente
- Informacion del almacen
- Fechas (pedido, entrega esperada)
- Notas y notas internas
- Acciones: Confirmar, Avanzar estado, Facturar, Cancelar
- Origen (presupuesto si aplica)

### 6. Frontend - Rutas y Menu

**Archivo:** `frontend/src/App.tsx` (modificado)

Rutas agregadas:
- `/orders` -> OrdersPage
- `/orders/new` -> NewOrderPage
- `/orders/:id` -> OrderDetailPage

**Archivo:** `frontend/src/components/layout/Sidebar.tsx` (modificado)

Menu Ventas actualizado:
- Listado
- Presupuestos
- **Pedidos** (nuevo)
- Clientes
- Categorias
- Cuentas Corrientes

### 7. Frontend - Actualizacion de Quotes

**Archivo:** `frontend/src/pages/quotes/QuotesPage.tsx` (modificado)

Agregado boton "Convertir a Pedido" en acciones de cada presupuesto

**Archivo:** `frontend/src/pages/quotes/QuoteDetailPage.tsx` (modificado)

Agregado boton "Convertir a Pedido" junto a "Convertir a Venta"

## Flujos Soportados

### Flujo 1: Presupuesto -> Pedido -> Venta
```
Presupuesto PRE-00001
    |
    v [Convertir a Pedido]
Pedido PED-00001 (con opcion de reservar stock)
    |
    v [Estados: DRAFT -> CONFIRMED -> PROCESSING -> READY]
    |
    v [Facturar]
Venta con CAE (si tiene conexion AFIP)
```

### Flujo 2: Presupuesto -> Venta (directo)
```
Presupuesto PRE-00001
    |
    v [Convertir a Venta]
Venta con CAE
```

### Flujo 3: Pedido directo -> Venta
```
Nuevo Pedido PED-00001
    |
    v [Estados operativos]
    |
    v [Facturar]
Venta con CAE
```

### Flujo 4: Tickets sin AFIP
```
Venta con VoucherConfiguration sin conexion AFIP
= Ticket interno que descuenta stock pero no informa a AFIP
```

## Comportamiento de Stock en Pedidos

| Opcion | Descripcion | Cuando se descuenta |
|--------|-------------|---------------------|
| `NONE` | Sin afectar stock | Al facturar (crear venta) |
| `RESERVE` | Reservar stock | Stock marcado como reservado, se consume al facturar |
| `DEDUCT` | Descontar inmediatamente | Al crear el pedido |

## Estados de Pedidos

| Estado | Descripcion | Acciones disponibles |
|--------|-------------|---------------------|
| `DRAFT` | Borrador | Confirmar, Cancelar |
| `CONFIRMED` | Confirmado | Avanzar, Facturar, Cancelar |
| `PROCESSING` | En preparacion | Avanzar, Facturar, Cancelar |
| `READY` | Listo para entrega | Facturar, Cancelar |
| `PARTIALLY_INVOICED` | Parcialmente facturado | Facturar (items pendientes) |
| `COMPLETED` | Completado | Solo lectura |
| `CANCELLED` | Cancelado | Solo lectura |

## Correcciones Realizadas

1. Corregido `orderService.ts`:
   - Cambiado `reference` a `referenceNumber` en StockMovement
   - Cambiado `createdBy` a `userId` en StockMovement
   - Cambiado `movementType: 'sale'` a `'OUT'` (formato correcto)
   - Cambiado `taxRate` de VatCondition a valor fijo de 21%

2. Corregido `quoteService.ts`:
   - Cambiado `taxRate` de VatCondition a valor fijo de 21%

3. Corregido `salesService.ts`:
   - Cambiado `taxRate` de VatCondition a valor fijo de 21%

## Archivos Creados

- `backend/src/services/orderService.ts`
- `backend/src/routes/orders.ts`
- `frontend/src/api/orders.ts`
- `frontend/src/pages/orders/OrdersPage.tsx`
- `frontend/src/pages/orders/NewOrderPage.tsx`
- `frontend/src/pages/orders/OrderDetailPage.tsx`

## Archivos Modificados

- `backend/src/server.ts` - Registro de rutas de orders
- `backend/src/services/quoteService.ts` - Nuevo metodo getDataForOrderConversion
- `backend/src/routes/quotes.ts` - Nuevo endpoint order-conversion-data
- `backend/src/services/salesService.ts` - Fix taxRate
- `frontend/src/App.tsx` - Rutas de orders
- `frontend/src/components/layout/Sidebar.tsx` - Menu Pedidos
- `frontend/src/pages/quotes/QuotesPage.tsx` - Boton convertir a pedido
- `frontend/src/pages/quotes/QuoteDetailPage.tsx` - Boton convertir a pedido

## Cambios Adicionales (Continuación de sesión)

### Integración Pedido → Venta Completada

**Archivo:** `frontend/src/pages/sales/NewSalePage.tsx` (modificado)

Cambios realizados:
1. Agregado import de `ordersApi`
2. Agregado `fromOrderId` desde URL params
3. Agregado estado `originOrderId` para tracking
4. Agregado `useEffect` para cargar datos del pedido cuando `?fromOrder=id` está presente
5. Agregado lógica en `onSuccess` para registrar la conversión del pedido cuando se crea la venta

Ahora el flujo completo funciona:
```
Presupuesto → Pedido → Venta (con CAE si aplica)
```

El botón "Facturar" en OrderDetailPage redirige a `/sales/new?fromOrder=id` y NewSalePage:
- Carga los datos del pedido (cliente, items pendientes)
- Al crear la venta, registra la conversión automáticamente
- Actualiza el estado del pedido a PARTIALLY_INVOICED o COMPLETED

## Pendiente para Proximas Sesiones

### Corto Plazo
1. ~~**Integracion con ventas desde pedido**~~ ✅ COMPLETADO
2. **Tests** - Probar los flujos completos
3. **PDF de pedido** - Template de impresion para pedidos

### Mediano Plazo
1. **Cuenta corriente de clientes** - Ya hay estructura base en entity-accounts
2. **Notificaciones** - Alertas de pedidos proximos a vencer
3. **Dashboard de pedidos** - Metricas de pedidos pendientes

## Notas Tecnicas

- La base de datos ya estaba sincronizada (prisma db push confirmo)
- El modelo CustomerOrder, CustomerOrderItem y StockReservation ya existian en el schema
- El unico error de compilacion pendiente es en `seed.ts` (preexistente, no critico)

## Como Continuar en Proxima Sesion

1. ~~Revisar si NewSalePage maneja el parametro `fromOrder`~~ ✅ COMPLETADO
2. **Probar el flujo completo**: Presupuesto -> Pedido -> Venta
3. **Verificar la reserva y liberacion de stock** en ambiente de pruebas
4. **Implementar PDF de pedido** si se requiere (template de impresion)
5. **Cuenta corriente de clientes** - siguiente funcionalidad prioritaria

## Resumen Final de la Sesion

### Logros Principales

1. **Modulo de Pedidos completo** - Backend + Frontend + API
2. **Integracion con Presupuestos** - Conversion Quote -> Order
3. **Integracion con Ventas** - Conversion Order -> Sale
4. **Sistema de Stock flexible** - NONE, RESERVE, DEDUCT
5. **Facturacion parcial** - Items pendientes trackeable

### Flujo Completo Implementado

```
[Presupuesto] ---> [Pedido] ---> [Venta/Factura]
     |                |              |
     |                |              +-- CAE AFIP (opcional)
     |                +-- Reserva/Descuento stock
     +-- Sin afectar stock
```

### Archivos Clave para Referencia

| Componente | Archivo |
|------------|---------|
| Servicio Orders | `backend/src/services/orderService.ts` |
| API Orders | `backend/src/routes/orders.ts` |
| Cliente API | `frontend/src/api/orders.ts` |
| Listado | `frontend/src/pages/orders/OrdersPage.tsx` |
| Nuevo Pedido | `frontend/src/pages/orders/NewOrderPage.tsx` |
| Detalle Pedido | `frontend/src/pages/orders/OrderDetailPage.tsx` |
| Nueva Venta | `frontend/src/pages/sales/NewSalePage.tsx` |

### Estado del Sistema

- **Base de datos**: Sincronizada con Prisma
- **Backend**: Compilando sin errores criticos
- **Frontend**: Funcional con todas las rutas
- **Flujos**: Presupuesto->Pedido->Venta operativos

---

## Cambios Finales (Continuación #2)

### 1. Fix Middleware Prisma - TenantId en modelos hijo

**Archivo:** `backend/src/middleware/tenantMiddleware.ts`

**Problema:** El middleware de Prisma agregaba `tenantId` automáticamente a TODAS las queries, pero algunos modelos no tienen ese campo (heredan tenant via relación padre).

**Solución:** Agregados a `skipModels`:
- `QuoteItem` (hereda de Quote)
- `CustomerOrderItem` (hereda de CustomerOrder)
- `StockReservation` (hereda de CustomerOrder)

### 2. Reordenamiento Menú Sidebar

**Archivo:** `frontend/src/components/layout/Sidebar.tsx`

**Cambio:** Menú "Ventas" reordenado:
```
Antes:                    Después:
1. Listado               1. Presupuestos
2. Presupuestos          2. Pedidos
3. Pedidos               3. Ventas (renombrado)
4. Clientes              4. Clientes
5. Categorías            5. Categorías
6. Cuentas Corrientes    6. Cuentas Corrientes
```

## Checklist de Cambios Realizados

### Backend
- [x] `backend/src/services/orderService.ts` - Servicio completo de pedidos
- [x] `backend/src/routes/orders.ts` - API REST de pedidos
- [x] `backend/src/services/quoteService.ts` - Método getDataForOrderConversion
- [x] `backend/src/routes/quotes.ts` - Endpoint order-conversion-data
- [x] `backend/src/server.ts` - Registro de rutas
- [x] `backend/src/middleware/tenantMiddleware.ts` - Fix skipModels (QuoteItem, CustomerOrderItem, StockReservation)

### Frontend
- [x] `frontend/src/api/orders.ts` - Cliente API de pedidos
- [x] `frontend/src/pages/orders/OrdersPage.tsx` - Listado de pedidos
- [x] `frontend/src/pages/orders/NewOrderPage.tsx` - Crear pedido
- [x] `frontend/src/pages/orders/OrderDetailPage.tsx` - Detalle de pedido
- [x] `frontend/src/pages/sales/NewSalePage.tsx` - Soporte ?fromOrder=id
- [x] `frontend/src/pages/quotes/QuotesPage.tsx` - Botón convertir a pedido
- [x] `frontend/src/pages/quotes/QuoteDetailPage.tsx` - Botón convertir a pedido
- [x] `frontend/src/App.tsx` - Rutas /orders/*
- [x] `frontend/src/components/layout/Sidebar.tsx` - Menú reordenado

### Documentación
- [x] `docs/SESION_2025-12-21.md` - Esta sesión
- [x] `docs/ROADMAP.md` - Actualizado estado

---

## Cambios Finales (Continuación #3) - Trazabilidad de Documentos

### Problema Identificado
El usuario necesitaba ver la **trazabilidad gráfica** de documentos: desde qué presupuesto/pedido se originó una venta, y qué pagos/notas de crédito tiene.

### Solución Implementada

#### 1. Backend - API de Trazabilidad

**Archivo NUEVO:** `backend/src/routes/traceability.ts`

Funcionalidades:
- `GET /api/:tenantSlug/traceability/:type/:id` - Obtener árbol de trazabilidad
- `type` puede ser: `quote`, `order`, `sale`
- Retorna:
  - `origin[]` - Documentos anteriores (hacia arriba en la cadena)
  - `tree` - Árbol de documentos derivados (hacia abajo)

Funciones internas:
- `getOriginChain()` - Busca documentos origen (Quote → Order → Sale)
- `buildTreeFromQuote()` - Construye árbol desde un presupuesto
- `buildTreeFromOrder()` - Construye árbol desde un pedido
- `buildTreeFromSale()` - Construye árbol desde una venta (incluye pagos y NC/ND)

**Registro:** Agregado en `backend/src/server.ts`:
```typescript
app.use('/api/:tenantSlug/traceability', traceabilityRoutes)
```

#### 2. Frontend - Cliente API

**Archivo NUEVO:** `frontend/src/api/traceability.ts`

```typescript
interface TraceabilityNode {
  id: string
  type: 'quote' | 'order' | 'sale' | 'payment' | 'credit_note' | 'debit_note'
  number: string
  date: string
  status: string
  amount: number
  customerName?: string
  children: TraceabilityNode[]
  metadata?: Record<string, any>
}

traceabilityApi.getTraceability(type, id) → { origin: [], tree: TraceabilityNode }
```

#### 3. Frontend - Modal de Trazabilidad

**Archivo NUEVO:** `frontend/src/components/traceability/TraceabilityModal.tsx`

Componentes:
- `TraceabilityModal` - Modal overlay con el árbol
- `TreeNode` - Componente recursivo para visualizar nodos

Características visuales:
- Iconos por tipo (FileText, ClipboardList, ShoppingCart, Banknote, Receipt)
- Colores por tipo (azul=presupuesto, amarillo=pedido, verde=venta, etc.)
- Badges de estado (pendiente, confirmado, completado, cancelado)
- Metadata visual (CAE, método de pago, comportamiento de stock)
- Leyenda de tipos de documentos
- Sección "ORIGEN" para documentos anteriores
- Árbol jerárquico con líneas de conexión

#### 4. Integración en Páginas

**Archivo:** `frontend/src/pages/sales/SalesPage.tsx`
- Agregado estado `traceabilityModal`
- Botón GitBranch abre modal en lugar de navegar
- Modal integrado al final del JSX

**Archivo:** `frontend/src/pages/quotes/QuoteDetailPage.tsx`
- Agregado import `TraceabilityModal`
- Agregado estado `showTraceability`
- Botón "Trazabilidad" abre modal
- Modal integrado al final del JSX

**Archivo:** `frontend/src/pages/orders/OrderDetailPage.tsx`
- Agregado import `useState` y `TraceabilityModal`
- Agregado estado `showTraceability`
- Botón "Trazabilidad" abre modal (antes navegaba a página)
- Modal integrado al final del JSX

### Correcciones de Errores

#### Fix 1: Campo paymentDate no existe
**Archivo:** `backend/src/routes/traceability.ts` (línea ~302)

**Problema:** `payment.paymentDate.toISOString()` → Error porque `SalePayment` no tiene `paymentDate`

**Solución:**
```typescript
// Antes (incorrecto):
date: payment.paymentDate.toISOString(),

// Después (correcto):
date: (payment.collectionDate || payment.createdAt).toISOString(),
```

#### Fix 2: Ventas no guardaban origen para trazabilidad
**Problema:** Cuando se creaba una venta desde presupuesto o pedido, no se guardaba `orderId` ni `quoteId`, por lo que la trazabilidad no podía mostrar el origen.

**Archivos modificados:**

1. `backend/src/routes/sales.ts` - Agregado al schema de validación:
```typescript
const createSaleSchema = z.object({
  // ... campos existentes ...
  orderId: z.string().optional(),
  quoteId: z.string().optional()
})
```

2. `backend/src/services/salesService.ts`:
```typescript
// Interface actualizada:
interface CreateSaleInput {
  // ... campos existentes ...
  orderId?: string  // ID del pedido origen
  quoteId?: string  // ID del presupuesto origen
}

// Destructuring actualizado:
const { ..., orderId, quoteId } = data

// Creación de venta actualizada:
const newSale = await tx.sale.create({
  data: {
    // ... campos existentes ...
    orderId: orderId || null,
    quoteId: quoteId || null,
  }
})
```

3. `frontend/src/pages/sales/NewSalePage.tsx` - Agregado a saleData (2 lugares):
```typescript
const saleData = {
  // ... campos existentes ...
  orderId: originOrderId || undefined,
  quoteId: originQuoteId || undefined
}
```

### Checklist de Cambios - Trazabilidad

#### Backend
- [x] `backend/src/routes/traceability.ts` - NUEVO - API de trazabilidad
- [x] `backend/src/server.ts` - Registro de ruta traceability
- [x] `backend/src/routes/sales.ts` - Agregado orderId/quoteId al schema
- [x] `backend/src/services/salesService.ts` - Guardar orderId/quoteId al crear venta

#### Frontend
- [x] `frontend/src/api/traceability.ts` - NUEVO - Cliente API
- [x] `frontend/src/components/traceability/TraceabilityModal.tsx` - NUEVO - Modal
- [x] `frontend/src/pages/sales/SalesPage.tsx` - Botón abre modal
- [x] `frontend/src/pages/quotes/QuoteDetailPage.tsx` - Botón abre modal
- [x] `frontend/src/pages/orders/OrderDetailPage.tsx` - Botón abre modal
- [x] `frontend/src/pages/sales/NewSalePage.tsx` - Enviar orderId/quoteId

### Flujo de Trazabilidad Implementado

```
HACIA ARRIBA (origen):           HACIA ABAJO (derivados):

[Presupuesto PRE-001] ───────┐
                             │
                             ▼
[Pedido PED-001] ────────────┼───────────┐
                             │           │
                             ▼           ▼
[Venta FAC A 0001-00000001] ─┼─────┬─────┴─────┐
                             │     │           │
                             ▼     ▼           ▼
                         [Pago 1] [Pago 2] [NC A 0001-00000002]
```

### Importante: Ventas Anteriores

Las ventas creadas **ANTES de este fix** no tendrán `orderId` ni `quoteId` guardados, por lo que su trazabilidad no mostrará el origen. Solo las **nuevas ventas** desde presupuesto/pedido mostrarán la cadena completa.

---

## Próximos Pasos para Siguiente Sesión

### Prioridad Alta
1. [ ] **Probar flujo completo de trazabilidad** - Crear presupuesto → pedido → venta y verificar modal
2. [ ] **PDF de pedido** - Template de impresión para pedidos
3. [ ] **Dashboard de pedidos** - Widget con pedidos pendientes/vencidos

### Prioridad Media
4. [ ] **Notificaciones** - Alertas de pedidos próximos a vencer fecha de entrega
5. [ ] **Reportes** - Agregar reportes de pedidos al módulo de reportes
6. [ ] **Filtros avanzados** - Rango de fechas, almacén, comportamiento de stock

### Prioridad Baja
7. [ ] **Página de trazabilidad standalone** - Mantener `/traceability/:type/:id` como opción
8. [ ] **Exportar trazabilidad** - PDF/Excel del árbol de documentos
9. [ ] **Trazabilidad de compras** - Mismo concepto para Purchase → SupplierPayment

### Bugs Conocidos (no críticos)
- [ ] Errores TypeScript preexistentes con `dialog.confirm` (debería ser `dialog.showConfirm`)
- [ ] Imports no usados en algunos archivos (Clock, Check, etc.)

---

## Resumen Ejecutivo de la Sesión Completa

### Módulos Implementados
1. **Pedidos (CustomerOrder)** - Flujo completo CRUD + estados + stock
2. **Trazabilidad** - Modal visual para seguir cadena de documentos

### Flujo de Negocio Soportado
```
[Presupuesto] ──┬──> [Pedido] ──> [Venta/Factura] ──> [Pago]
                │                        │
                │                        └──> [Nota de Crédito]
                │                        └──> [Nota de Débito]
                │
                └──> [Venta Directa]
```

### Archivos Creados (Total)
- `backend/src/services/orderService.ts`
- `backend/src/routes/orders.ts`
- `backend/src/routes/traceability.ts`
- `frontend/src/api/orders.ts`
- `frontend/src/api/traceability.ts`
- `frontend/src/pages/orders/OrdersPage.tsx`
- `frontend/src/pages/orders/NewOrderPage.tsx`
- `frontend/src/pages/orders/OrderDetailPage.tsx`
- `frontend/src/components/traceability/TraceabilityModal.tsx`
- `frontend/src/pages/traceability/TraceabilityPage.tsx` (obsoleto, usar modal)

### Archivos Modificados (Resumen)
- Backend: server.ts, sales.ts, salesService.ts, quotes.ts, quoteService.ts, tenantMiddleware.ts
- Frontend: App.tsx, Sidebar.tsx, NewSalePage.tsx, SalesPage.tsx, QuoteDetailPage.tsx, QuotesPage.tsx, OrderDetailPage.tsx

---
**Última actualización:** 2025-12-21 17:35
